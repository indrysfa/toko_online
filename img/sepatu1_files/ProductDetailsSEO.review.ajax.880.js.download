var reviewContextUrl=CONSTANTS.baseUrl+"api/product/detail/review/",_token=$("meta[name\x3d'_csrf']").attr("content"),_header=$("meta[name\x3d'_csrf_header']").attr("content"),TEMPLATE_BASE="/static-root/dynamichtml/",TEMPLATE_URL=TEMPLATE_BASE+"pr/ProductDetails.review.tmpl.html",defaultAverageScoreElementName="averageScore",defaultTotalReviewCountElementName="totalReviewCount",defaultNaviLimit=5,defaultRowCount=10,registReviewDrawFlag=!1,makeReviewFlag=!1;$.namespace("lotteindo.pr.ProductDetailsReviewAjax.eventHandler");
lotteindo.pr.ProductDetailsReviewAjax.eventHandler={init:function(b,a){CONSTANTS.pr={};CONSTANTS.pr.orderKind={"":MESSAGES.format("pr.js.ProductReview.label.recentlyRegistered"),high:MESSAGES.format("pr.js.ProductReview.label.highScore"),low:MESSAGES.format("pr.js.ProductReview.label.lowScore")};CONSTANTS.pr.reviewType={"":MESSAGES.format("pr.js.ProductReview.label.viweAll"),text:MESSAGES.format("pr.js.ProductReview.label.generalReviews"),photo:MESSAGES.format("pr.js.ProductReview.label.photoReviews")};
$("#orderKind").empty();jQuery.each(CONSTANTS.pr.orderKind,function(a,b){a=$("\x3coption\x3e").val(a).text(b);$("#orderKind").append(a)});$("#reviewType").empty();jQuery.each(CONSTANTS.pr.reviewType,function(a,b){a=$("\x3coption\x3e").val(a).text(b);$("#reviewType").append(a)});$("#reviewType").change(function(){lotteindo.pr.ProductDetailsReviewAjax.eventHandler.makeReviewSection(1,a)});$("#orderKind").change(function(){lotteindo.pr.ProductDetailsReviewAjax.eventHandler.makeReviewSection(1,a)})},
getReviewScore:function(b,a,c,d){indolotte.common.Ajax.sendJSONRequest("GET",reviewContextUrl+"summaryScore/"+b,null,function(b){console.log(b);if(b.succeeded)if(d)d(b.data.scoreList,a,c);else return b.data.scoreList;else return null})},getReviewList:function(b,a,c){indolotte.common.Ajax.sendJSONRequest("GET",reviewContextUrl+"list/"+a+"/"+b,{reviewType:$("#reviewType").val(),orderKind:$("#orderKind").val()},function(b){console.log(b);if(b.succeeded)if(c)c(a,b.data);else return b.data;else return null})},
registerProductReview:function(){if(""==$.trim($("#inp_board_txt2").val())||10>$.trim($("#inp_board_txt2").val()).length)return lotteindo.pr.common.ProductUtil.Layer.alert(MESSAGES.format("pr.js.ProductDetail.message.enterContent"),"",function(a){}),!1;var b=reviewContextUrl+"add",a=[];$(".re_rating li").each(function(b,d){b={productEvaluationPropertyCode:$(this).data("evaluationcode"),productEvaluationScore:$(".re_rating li:eq("+b+") strong").text().replaceAll(",",".")};a.push(b)});for(var c=[],
d=0;d<reviewAttachImageList.length;d++)c.push({imageURLAddress:reviewAttachImageList[d].tempUrl});d=lotteindo.pr.common.ProductUtil.Review.read();c={productNumber:$("#productNumber").val(),orderNumber:d.orderNumber,itemNumber:d.itemNumber,orderQuantity:d.orderQuantity,orderDateTime:d.orderDateTime,connectionMediaCode:"01",scoreList:a,imageList:c,content:lotteindo.pr.common.ProductUtil.cutByteLength(lotteindo.pr.common.ProductUtil.leftTagConvert($("#inp_board_txt2").val()),2E3)};indolotte.common.Ajax.sendJSONRequest("POST",
b,JSON.stringify(c),function(a){a.succeeded?a.data.validExtention?(animateWriteReview("close"),lotteindo.pr.ProductDetailsReviewAjax.eventHandler.setTotalReviewScore($("#productNumber").val()),lotteindo.pr.ProductDetailsReviewAjax.eventHandler.makeReviewSection(1,$("#productNumber").val())):lotteindo.pr.common.ProductUtil.Layer.alert(MESSAGES.format("pr.js.ProductReview.message.allowFileExtention",["(jpg, png, jpeg, gif)"]),"",function(a){}):lotteindo.pr.common.ProductUtil.Layer.alert(MESSAGES.format("pr.js.ProductDetail.message.noEligibleToReview"),
"",function(a){})})},deleteProductReview:function(b){var a=MESSAGES.format("pr.js.ProductDetail.message.reviewDeleteConfirm");lotteindo.pr.common.ProductUtil.Layer.confirm(a,"",function(a){a&&indolotte.common.Ajax.sendJSONRequest("POST",reviewContextUrl+"delete/"+b,null,function(a){lotteindo.pr.ProductDetailsReviewAjax.eventHandler.setTotalReviewScore($("#productNumber").val());lotteindo.pr.ProductDetailsReviewAjax.eventHandler.makeReviewSection(1,$("#productNumber").val())})})},attachReviewImageFile:function(){reviewAttachImageList=
[];$("#inp_board_file1_2").change(function(b){b.preventDefault();b=$("#inp_board_file1_2")[0].files[0].name;var a=b.lastIndexOf(".");-1!==a&&(type=b.substring(a+1,b.len).toLowerCase());if(0>$.inArray(type,"jpg jpeg png heic tiff gif".split(" ")))lotteindo.pr.common.ProductUtil.Layer.alert(MESSAGES.format("pr.js.ProductReview.message.allowFileExtention",["(jpg, png, jpeg, gif)"]),"",function(a){});else if(3==reviewAttachImageList.length)lotteindo.pr.common.ProductUtil.Layer.alert(MESSAGES.format("pr.js.ProductReview.message.maximumImage"),
"",function(a){});else{b=CONSTANTS.baseUrl+"api/pr/productReview/uploadTempImage";var c=$("meta[name\x3d'_csrf']").attr("content"),d=$("meta[name\x3d'_csrf_header']").attr("content"),a=new FormData;a.append("uploadImage",$("#inp_board_file1_2")[0].files[0]);$.ajax({url:b,type:"post",data:a,processData:!1,contentType:!1,dataType:"json",async:!1,success:function(a,b,d){reviewAttachImageList.push({url:a[0].url,tempUrl:a[0].tempUrl});a="\x3cli\x3e\x3cdiv class\x3d'cell cell_thumb_file'\x3e"+("\x3cimg name\x3d'registReviewImage' class\x3d'thumb_file' src\x3d'"+
a[0].url+"' alt\x3d''\x3e");a+="\x3cbutton type\x3d'button' class\x3d'btn_del' onclick\x3d'lotteindo.pr.ProductDetailsReviewAjax.eventHandler.deleteAttachReviewImageFile(this)'\x3eDelete\x3c/button\x3e\x3c/div\x3e\x3c/li\x3e";$("#attachImageList").append(a)},error:function(a,b,d){},beforeSend:function(a){null!=d&&""!==d&&a.setRequestHeader(d,c)},complete:function(){}})}})},deleteAttachReviewImageFile:function(b){var a=MESSAGES.format("pr.js.BigDealDetail.message.imageDeleteConfrim"),c=$(b).parent().children($("img")).attr("src");
lotteindo.pr.common.ProductUtil.Layer.confirm(a,c,function(a){a&&($(b).parent().parent().remove(),reviewAttachImageList=$.grep(reviewAttachImageList,function(a,b){return a.url!=c}))})},setReviewList:function(b,a){$(".board_wrap .board_list tbody").empty();$(".paginate").empty();makeReviewList(a);null!=a&&null!=a.productReviewList&&0<a.productReviewList.length&&(a=getNavigationCount(a.page,a.totalReviewCount,a.rowsPerPage),makePagingNavigation(b,a),makeReviewFlag||prdt_Revdetail(),makeReviewFlag=!0)},
setReviewScore:function(b,a,c){changeScoreInfo(b,a,c);makeRegistReviewScore()},makeReviewSection:function(b,a){lotteindo.pr.ProductDetailsReviewAjax.eventHandler.getReviewList(b,a,lotteindo.pr.ProductDetailsReviewAjax.eventHandler.setReviewList)},setTotalReviewScore:function(b,a,c){a=a?a:defaultTotalReviewCountElementName;c=c?c:defaultAverageScoreElementName;lotteindo.pr.ProductDetailsReviewAjax.eventHandler.getReviewScore(b,a,c,lotteindo.pr.ProductDetailsReviewAjax.eventHandler.setReviewScore)}};
function getNavigationCount(b,a,c,d){d=null==d?defaultNaviLimit:d;c=null==c?defaultRowCount:c;var e=Math.ceil(a/c),h,f;1>=b-2?(h=1,f=0<e-d?d:e):b+2>=e?(h=1>=e-4?1:e-4,f=e):(h=b-2,f=b+2);return{naviLimit:d,rowCount:c,pageIdx:b,totalCount:a,pageCount:e,startPage:h,endPage:f}}
function makePagingNavigation(b,a){for(var c=$("\x3ca\x3e").attr("href","javascript:;").attr("data-pageidx",a.startPage).addClass("btn_first").append($("\x3cspan\x3e").addClass("hidden").text("First page")).click(function(){a.pageIdx!=$(this).data("pageidx")&&lotteindo.pr.ProductDetailsReviewAjax.eventHandler.makeReviewSection($(this).data("pageidx"),b)}),d=$("\x3ca\x3e").attr("href","javascript:;").attr("data-pageIdx",1>=a.pageIdx-1?1:a.pageIdx-1).addClass("btn_prev").append($("\x3cspan\x3e").addClass("hidden").text("Prev page")).click(function(){a.pageIdx!=
$(this).data("pageidx")&&lotteindo.pr.ProductDetailsReviewAjax.eventHandler.makeReviewSection($(this).data("pageidx"),b)}),e=$("\x3cspan\x3e").addClass("page_num"),h=$("\x3ca\x3e").attr("href","javascript:;").attr("data-pageIdx",a.pageIdx+1>=a.endPage?a.endPage:a.pageIdx+1).addClass("btn_next").append($("\x3cspan\x3e").addClass("hidden").text("Next page")).click(function(){a.pageIdx!=$(this).data("pageidx")&&lotteindo.pr.ProductDetailsReviewAjax.eventHandler.makeReviewSection($(this).data("pageidx"),
b)}),f=$("\x3ca\x3e").attr("href","javascript:;").attr("data-pageIdx",a.endPage).addClass("btn_last").append($("\x3cspan\x3e").addClass("hidden").text("Last page")).click(function(){a.pageIdx!=$(this).data("pageidx")&&lotteindo.pr.ProductDetailsReviewAjax.eventHandler.makeReviewSection($(this).data("pageidx"),b)}),g=a.startPage;g<=a.endPage;g++)g===a.pageIdx?e.append($("\x3cstrong\x3e").text(g)):e.append($("\x3ca\x3e").attr("href","javascript:;").text(g).click(function(){lotteindo.pr.ProductDetailsReviewAjax.eventHandler.makeReviewSection($(this).text(),
b)}));$(".paginate").append(c).append(d).append(e).append(h).append(f)}
function makeReviewList(b){console.log(b);if(null!=b&&null!=b.productReviewList&&0<b.productReviewList.length){b=b.productReviewList;for(var a=0;a<b.length;a++){var c=$("\x3ctr\x3e"),d=$("\x3ctd\x3e"),e=$("\x3cdiv\x3e").addClass("board_score_info"),h=$("\x3cdiv\x3e").addClass("score_star_box"),f=h.append(getReviewStarClass(b[a].reviewScore)),g=$("\x3cstrong\x3e").addClass("num").text((b[a].reviewScore+"").replaceAll(".",","));h.append(f);e.append(h.append(g));h=$("\x3cdiv\x3e").addClass("board_txt_name").text(b[a].firstRegistrationPersonId);
f=$("\x3cdiv\x3e").addClass("board_txt_date").text(b[a].productReviewRegistrationDate);d.addClass("review-data").append(h);d.addClass("review-data").append(e);d.addClass("review-data").append(f);e=$("\x3ctd\x3e");$("\x3cspan\x3e").addClass("board_txt_date").text(b[a].firstRegistrationPersonId);h=$("\x3ctd\x3e");$("\x3cspan\x3e").addClass("board_txt_date").text(b[a].productReviewRegistrationDate);f=$("\x3ctd\x3e");if(null!=b[a].productReviewAttachImageList&&0<b[a].productReviewAttachImageList.length){var g=
$("\x3cdiv\x3e").addClass("img_review"),k=$("\x3cimg\x3e").attr("src",b[a].productReviewAttachImageList[0].imageURLAddress);g.append(k);g=$("\x3cp\x3e");"Y"==b[a].deletePossibleYNFlag&&(k=$("\x3cspan\x3e").attr("data-reviewnumber",b[a].productReviewNumber).addClass("ico_del"),k.on("click",function(a){lotteindo.pr.ProductDetailsReviewAjax.eventHandler.deleteProductReview($(this).data("reviewnumber"))}),g.append(k));h.append(g);g=$("\x3cdiv\x3e").addClass("review_detail");null!=b[a].optionValue&&void 0!=
b[a].optionValue&&""!=b[a].optionValue&&(k=$("\x3cp\x3e").addClass("mgb5").text(b[a].optionValue),g.append(k));k=$("\x3cp\x3e").attr("align","justify").addClass("txt_s").addClass("mgb10");k.append(b[a].content);g.append(k);for(k=0;k<b[a].productReviewAttachImageList.length;k++){var l=$("\x3ca\x3e").attr("href","javascript:;").addClass("sss_img"),m=$("\x3cspan\x3e"),n=$("\x3cimg\x3e").attr("src",b[a].productReviewAttachImageList[k].imageURLAddress).addClass("sss_img");m.append(n);l.append(m);g.append(l)}}else g=
$("\x3cp\x3e"),"Y"==b[a].deletePossibleYNFlag&&(k=$("\x3cspan\x3e").attr("data-reviewnumber",b[a].productReviewNumber).addClass("ico_del"),k.on("click",function(a){lotteindo.pr.ProductDetailsReviewAjax.eventHandler.deleteProductReview($(this).data("reviewnumber"))}),g.append(k)),h.append(g),g=$("\x3cdiv\x3e").addClass("review_detail"),null!=b[a].optionValue&&void 0!=b[a].optionValue&&""!=b[a].optionValue&&(k=$("\x3cp\x3e").addClass("mgb5").text(b[a].optionValue),g.append(k)),k=$("\x3cp\x3e").attr("align",
"justify").addClass("txt_s").addClass("mgb10"),k.append(b[a].content),g.append(k);f.append(g);c.append(d).append(f).append(e).append(h);$(".board_wrap .board_list tbody").append(c)}}}
function changeScoreInfo(b,a,c){var d=Object.keys(CONSTANTS.prdDetail.PRD_EVAL_PROP_CD).length,e=$("[name\x3d"+a+"]");a=$("[name\x3d"+a+"Plus]");""==b?(e.text("(0) Review"),a.text("0 "+MESSAGES.format("pr.js.BigDealDetail.label.productReviews"))):(e.text("("+b[0].totalReviewCount+") Review"),a.text(b[0].totalReviewCount+" "+MESSAGES.format("pr.js.BigDealDetail.label.productReviews")));for(a=e=0;a<b.length;a++)e+=b[a].productEvaluationScore;var h=0;0!=b.length&&(h=e/b.length);$("[name\x3d"+c+"]").text(h.toFixed(1).replaceAll(".",
","));c=$(".score_star_box");$(c[1]).find(".star_rating").removeClass("on");$("span[name\x3dproductEvaluationScoreStarBottom]").each(function(a){$(this).addClass(lotteindo.pr.common.ProductUtil.getReviewLargeStarClass(h,a+1))});$("span[name\x3dproductEvaluationScoreStar]").each(function(a){$(this).addClass(lotteindo.pr.common.ProductUtil.getReviewLargeStarClass(h,a+1))});e=$(".breakdown_average_rating");c=e.find(".score_txt2");a=e.find(".board_score_info");e=a.find(".num");a=a.find(".score_star_box");
console.log(b);for(var f=0;f<d;f++)if(b.length>f){var g=getReviewStarClass(b[f].productEvaluationScore);$(c[f]).text(CONSTANTS.prdDetail.PRD_EVAL_PROP_CD[b[f].productEvaluationPropertyCode]);$(a[f]).append(g);$(e[f]).text((b[f].productEvaluationScore+"").replaceAll(".",","))}else g=getReviewStarClass(0),$(c[f]).text(CONSTANTS.prdDetail.PRD_EVAL_PROP_CD["0"+(f+1)]),$(a[f]).append(g),$(e[f]).text(0)}
function makeRegistReviewScore(){if(!registReviewDrawFlag){var b=$(".re_rating");for(index=0;index<Object.keys(CONSTANTS.prdDetail.PRD_EVAL_PROP_CD).length;index++){for(var a=$("\x3cli\x3e").attr("data-evaluationcode","0"+(index+1)),c=$("\x3cp\x3e").addClass("score_txt2").text(CONSTANTS.prdDetail.PRD_EVAL_PROP_CD["0"+(index+1)]),d=$("\x3cdiv\x3e").addClass("score_star_ui").addClass("star_num"),e=1;7>e;e++)if(6>e){var h=$("\x3cinput\x3e").attr("type","radio").attr("id","inp_star"+(index+1)+"_"+e).attr("name",
"inp_star"+(index+1)).attr("value",""+e),f=$("\x3clabel\x3e").attr("for","inp_star"+(index+1)+"_"+e);1==e?f.text(MESSAGES.format("pr.js.ProductReview.message.veryDissatisfied")):2==e?f.text(MESSAGES.format("pr.js.ProductReview.message.somewhatDissatisfied")):3==e?f.text(MESSAGES.format("pr.js.ProductReview.message.neitherSatisfiedNorDissatisfied")):4==e?f.text(MESSAGES.format("pr.js.ProductReview.message.somewhatSatisfied")):f.text(MESSAGES.format("pr.js.ProductReview.message.verySatisfied"));f.addClass("on");
d.append(h);d.append(f)}else h=$("\x3cstrong\x3e").addClass("num").text("5,0"),d.append(h);a.append(c).append(d);b.append(a)}score_Star();lotteindo.pr.ProductDetailsReviewAjax.eventHandler.attachReviewImageFile()}registReviewDrawFlag=!0}
function getReviewStarClass(b){for(var a="",c=Math.floor(b),d=1;5>=d;d++)a=d<=c?a+'\x3cspan class\x3d"star_rating on"\x3e\x3c/span\x3e':0<d-b&&1>d-b?a+'\x3cspan class\x3d"star_rating on half"\x3e\x3c/span\x3e':a+'\x3cspan class\x3d"star_rating"\x3e\x3c/span\x3e';return a}
function changeReviewWideImage(){$("img[name\x3dreviewTitleImage]").click(function(b){var a=1*$(this).data("index"),c=$(this).attr("src");$("img[name\x3dreviewWideImage]").each(function(b){if(b==a)return $(this).attr("src",c),!1});$("div[name\x3dreviewDetailDiv]").each(function(b){if(b==a)return $(this).show(),!1})})}function animateWriteReview(b){"open"==b?$(".prdt_review").animate({height:"700px"},1E3):$(".prdt_review").animate({height:"0px"},1E3)};